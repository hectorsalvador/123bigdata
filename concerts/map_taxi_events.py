### Computer Science with Applications III
### Analyzing NYC Taxi Data
### Lauren Dyson, Carlos Grandet, Hector Salvador
### June 2016

'''
This file uses MapReduce to count the number of times that taxi rides are made in an area around
a particular set of coordinates (lat,lon). The file is used both for taxi an uber 
files, which have different column formats; notice that one should manually uncomment indicated
code lines to do so.
'''

from mrjob.job import MRJob
from mrjob.step import MRStep
from datetime import datetime, timedelta
from haversine import haversine
import json

## Comment/Uncomment to use file with taxi and uber files

# To use with taxi files
# TAXI_DATE_COL = 1
# TAXI_PICKUP_LAT_COL = 6
# TAXI_PICKUP_LON_COL = 5

# To use with uber files
UBER_DATE_COL = 0
UBER_LAT_COL = 1
UBER_LON_COL = 2

KM_DIST = 0.2
HOURS_OF_TOLERANCE = 3
EVENTS_JSON = {"lady%20gaga @Radio City Music Hall, 2015-06-19T20:00:00": {"date": "2015-06-19T20:00:00", "pickup": [40.7599077, -73.9802926]}, "jason%20mraz @Madison Square Garden, 2012-12-10T19:30:00": {"date": "2012-12-10T19:30:00", "pickup": [40.7504807, -73.9933853]}, "selena%20gomez @Late Night, 2010-07-21T00:30:00": {"date": "2010-07-21T00:30:00", "pickup": [40.758912, -73.979077]}, "chris%20brown @Barclays Center, 2015-02-16T19:30:00": {"date": "2015-02-16T19:30:00", "pickup": [40.682691, -73.975324]}, "maroon%205 @Toyota Concert Series on Today, 2010-07-02T06:00:00": {"date": "2010-07-02T06:00:00", "pickup": [40.714489, -74.007133]}, "kenny%20chesney @ROCKS OFF Concert Cruise Series, 2014-09-20T19:00:00": {"date": "2014-09-20T19:00:00", "pickup": [40.76289, -74.00175]}, "linkin%20park @Nokia Theatre Times Square, 2010-09-14T21:00:00": {"date": "2010-09-14T21:00:00", "pickup": [40.757423, -73.986023]}, "katy%20perry @Hammerstein Ballroom, 2009-07-28T19:30:00": {"date": "2009-07-28T19:30:00", "pickup": [40.752535, -73.99391]}, "enrique%20iglesias @Madison Square Garden, 2011-11-04T19:00:00": {"date": "2011-11-04T19:00:00", "pickup": [40.7504807, -73.9933853]}, "the%20black%20eyed%20peas @Central Park, 2011-06-20T15:30:00": {"date": "2011-06-20T15:30:00", "pickup": [40.770519, -73.968452]}, "paul%20mccartney @New Yankee Stadium, 2011-07-16T20:00:00": {"date": "2011-07-16T20:00:00", "pickup": [40.829245, -73.928601]}, "wiz%20khalifa @Central Park SummerStage, 2011-07-25T19:30:00": {"date": "2011-07-25T19:30:00", "pickup": [40.770519, -73.968452]}, "paul%20mccartney @Citi Field, 2009-07-18T19:00:00": {"date": "2009-07-18T19:00:00", "pickup": [40.7571, -73.8458]}, "nicki%20minaj @Barclays Center, 2014-09-09T21:00:00": {"date": "2014-09-09T21:00:00", "pickup": [40.682691, -73.975324]}, "justin%20bieber @Madison Square Garden, 2010-12-10T19:00:00": {"date": "2010-12-10T19:00:00", "pickup": [40.7504807, -73.9933853]}, "pharrell%20williams @Apollo Theater, 2014-06-03T20:00:00": {"date": "2014-06-03T20:00:00", "pickup": [40.810232, -73.949836]}, "iggy%20azalea @Bowery Ballroom, 2013-06-17T20:00:00": {"date": "2013-06-17T20:00:00", "pickup": [40.720398, -73.993731]}, "coldplay @Barclays Center, 2012-12-31T21:00:00": {"date": "2012-12-31T21:00:00", "pickup": [40.682691, -73.975324]}, "wiz%20khalifa @Highline Ballroom, 2009-11-24T19:00:00": {"date": "2009-11-24T19:00:00", "pickup": [40.743339, -74.00656]}, "alicia%20keys @Radio City Music Hall, 2009-07-18T20:00:00": {"date": "2009-07-18T20:00:00", "pickup": [40.649903, -74.001935]}, "coldplay @Barclays Center, 2012-12-30T19:00:00": {"date": "2012-12-30T19:00:00", "pickup": [40.682691, -73.975324]}, "selena%20gomez @Fox & Friends, 2010-07-22T06:00:00": {"date": "2010-07-22T06:00:00", "pickup": [40.75869, -73.982391]}, "chris%20brown @Barclays Center, 2015-01-29T19:30:00": {"date": "2015-01-29T19:30:00", "pickup": [40.682691, -73.975324]}, "lady%20gaga @Madison Square Garden, 2014-05-13T20:00:00": {"date": "2014-05-13T20:00:00", "pickup": [40.7504807, -73.9933853]}, "katy%20perry @Rockefeller Plaza, 2009-07-24T19:00:00": {"date": "2009-07-24T19:00:00", "pickup": [40.7587, -73.9787]}, "calvin%20harris @Terminal 5, 2010-12-22T19:00:00": {"date": "2010-12-22T19:00:00", "pickup": [40.769704, -73.992414]}, "adele @Beacon Theatre, 2011-05-19T20:00:00": {"date": "2011-05-19T20:00:00", "pickup": [40.7803275, -73.9816297]}, "ariana%20grande @Playstation Theater, 2013-08-14T19:00:00": {"date": "2013-08-14T19:00:00", "pickup": [40.757419, -73.98603]}, "pitbull @Radio City Music Hall, 2012-04-06T20:00:00": {"date": "2012-04-06T20:00:00", "pickup": [40.649903, -74.001935]}, "katy%20perry @Madison Square Garden, 2014-07-09T19:00:00": {"date": "2014-07-09T19:00:00", "pickup": [40.7504807, -73.9933853]}, "ariana%20grande @Madison Square Garden, 2015-03-21T19:30:00": {"date": "2015-03-21T19:30:00", "pickup": [40.7504807, -73.9933853]}, "snoop%20dogg @The Fillmore New York at Irving Plaza, 2010-04-20T21:00:00": {"date": "2010-04-20T21:00:00", "pickup": [40.7349, -73.9884]}, "calvin%20harris @The Fillmore New York at Irving Plaza, 2009-04-06T19:00:00": {"date": "2009-04-06T19:00:00", "pickup": [40.7349, -73.9884]}, "lady%20gaga @Barclays Center, 2013-03-06T19:00:00": {"date": "2013-03-06T19:00:00", "pickup": [40.682691, -73.975324]}, "avicii @Lavo Nightclub, 2013-09-17T23:00:00": {"date": "2013-09-17T23:00:00", "pickup": [40.7630153, -73.971319]}, "alicia%20keys @Hammerstein Ballroom, 2011-11-03T18:00:00": {"date": "2011-11-03T18:00:00", "pickup": [40.752535, -73.99391]}, "miley%20cyrus @Nassau Coliseum, 2009-11-18T19:00:00": {"date": "2009-11-18T19:00:00", "pickup": [40.71455, -74.007118]}, "wiz%20khalifa @The Fillmore New York at Irving Plaza, 2010-03-26T21:00:00": {"date": "2010-03-26T21:00:00", "pickup": [40.7349, -73.9884]}, "one%20direction @Madison Square Garden, 2012-12-07T19:00:00": {"date": "2012-12-07T19:00:00", "pickup": [40.7504807, -73.9933853]}, "ariana%20grande @Family Day - TJ Martell Foundation, 2012-04-22T12:30:00": {"date": "2012-04-22T12:30:00", "pickup": [40.763197, -73.98372]}, "nicki%20minaj @Nassau Coliseum, 2011-03-28T19:00:00": {"date": "2011-03-28T19:00:00", "pickup": [40.71455, -74.007118]}, "ariana%20grande @Pier 26, 2015-06-28T15:00:00": {"date": "2015-06-28T15:00:00", "pickup": [40.7217861, -74.0094471]}, "snoop%20dogg @Reincarnated the Film in theaters 3/15 - 3/21, 2013-03-15T19:00:00": {"date": "2013-03-15T19:00:00", "pickup": [40.7141667, -74.0063889]}, "kelly%20clarkson @LATE SHOW, 2009-07-15T20:00:00": {"date": "2009-07-15T20:00:00", "pickup": [40.763802, -73.982833]}, "katy%20perry @Z100 Jingle Bell Ball, 2010-12-10T19:00:00": {"date": "2010-12-10T19:00:00", "pickup": [40.78701, -73.977814]}, "lady%20gaga @Roseland Ballroom, 2014-03-30T20:00:00": {"date": "2014-03-30T20:00:00", "pickup": [40.762979, -73.983492]}, "alicia%20keys @Madison Square Garden, 2010-03-17T19:30:00": {"date": "2010-03-17T19:30:00", "pickup": [40.7504807, -73.9933853]}, "radiohead @Roseland Ballroom, 2011-09-28T18:30:00": {"date": "2011-09-28T18:30:00", "pickup": [40.762979, -73.983492]}, "katy%20perry @The Fillmore New York at Irving Plaza, 2009-04-07T19:00:00": {"date": "2009-04-07T19:00:00", "pickup": [40.735, -73.9884]}, "snoop%20dogg @Nokia Theatre Times Square, 2009-10-29T19:00:00": {"date": "2009-10-29T19:00:00", "pickup": [40.757423, -73.986023]}, "lady%20gaga @Terminal 5, 2009-03-31T19:00:00": {"date": "2009-03-31T19:00:00", "pickup": [40.769704, -73.992414]}, "pitbull @B.B. King Blues Club and Grill, 2009-10-20T20:00:00": {"date": "2009-10-20T20:00:00", "pickup": [40.756962, -73.988417]}, "the%20black%20eyed%20peas @Saturday Night Live, 2009-11-14T20:00:00": {"date": "2009-11-14T20:00:00", "pickup": [40.71455, -74.007124]}, "chris%20brown @Nokia Theatre Times Square, 2009-12-15T19:00:00": {"date": "2009-12-15T19:00:00", "pickup": [40.757423, -73.986023]}, "lady%20gaga @Madison Square Garden, 2013-02-22T19:00:00": {"date": "2013-02-22T19:00:00", "pickup": [40.7504807, -73.9933853]}, "lady%20gaga @Madison Square Garden, 2010-07-09T20:00:00": {"date": "2010-07-09T20:00:00", "pickup": [40.7504807, -73.9933853]}, "britney%20spears @Madison Square Garden, 2009-08-25T20:00:00": {"date": "2009-08-25T20:00:00", "pickup": [40.7504807, -73.9933853]}, "pharrell%20williams @Madison Square Garden, 2014-12-12T19:00:00": {"date": "2014-12-12T19:00:00", "pickup": [40.7504807, -73.9933853]}, "rihanna @Barclays Center, 2013-05-04T20:00:00": {"date": "2013-05-04T20:00:00", "pickup": [40.682691, -73.975324]}, "kelly%20clarkson @Saturday Night Live, 2009-05-02T23:30:00": {"date": "2009-05-02T23:30:00", "pickup": [40.71455, -74.007124]}, "coldplay @Battery Park, 2009-08-02T12:00:00": {"date": "2009-08-02T12:00:00", "pickup": [40.703457, -74.016787]}, "tim%20mcgraw @Manhattan Center Hammerstein Ballroom, 2014-09-16T19:00:00": {"date": "2014-09-16T19:00:00", "pickup": [40.752535, -73.99391]}, "the%20lumineers @Terminal 5, 2013-02-02T19:00:00": {"date": "2013-02-02T19:00:00", "pickup": [40.769704, -73.992414]}, "pitbull @Madison Square Garden, 2011-11-04T19:00:00": {"date": "2011-11-04T19:00:00", "pickup": [40.7504807, -73.9933853]}, "snoop%20dogg @The Wellmont Theatre, 2012-09-27T19:00:00": {"date": "2012-09-27T19:00:00", "pickup": [40.812646, -74.2167]}, "lady%20gaga @Madison Square Garden, 2010-07-07T20:00:00": {"date": "2010-07-07T20:00:00", "pickup": [40.7504807, -73.9933853]}, "justin%20bieber @Arthur Ashe Kids Day, 2009-08-29T10:00:00": {"date": "2009-08-29T10:00:00", "pickup": [40.7499, -73.847]}, "lady%20gaga @Roseland Ballroom, 2014-04-06T20:00:00": {"date": "2014-04-06T20:00:00", "pickup": [40.762979, -73.983492]}, "adele @United Palace Theatre, 2011-05-21T20:00:00": {"date": "2011-05-21T20:00:00", "pickup": [40.74414, -73.794549]}, "selena%20gomez @Madison Square Garden, 2010-12-10T19:00:00": {"date": "2010-12-10T19:00:00", "pickup": [40.7504807, -73.9933853]}, "selena%20gomez @Good Morning America Summer Concert Series: Rumsey Field in Central Park, 2013-07-26T19:00:00": {"date": "2013-07-26T19:00:00", "pickup": [40.757024, -73.985824]}, "macklemore @Irving Plaza powered by Klipsch, 2012-11-21T19:00:00": {"date": "2012-11-21T19:00:00", "pickup": [40.73482, -73.988313]}, "prince @Pianos NYC, 2010-11-26T20:00:00": {"date": "2010-11-26T20:00:00", "pickup": [40.720984, -73.987707]}, "prince @Madison Square Garden, 2011-02-07T19:30:00": {"date": "2011-02-07T19:30:00", "pickup": [40.7504807, -73.9933853]}, "justin%20bieber @Madison Square Garden, 2009-12-11T19:30:00": {"date": "2009-12-11T19:30:00", "pickup": [40.7504807, -73.9933853]}, "mariah%20carey @Beacon Theatre, 2014-12-15T20:00:00": {"date": "2014-12-15T20:00:00", "pickup": [40.7803275, -73.9816297]}, "wiz%20khalifa @Roseland Ballroom, 2011-03-29T20:00:00": {"date": "2011-03-29T20:00:00", "pickup": [40.762979, -73.983492]}, "pitbull @Barclays Center, 2014-09-09T21:00:00": {"date": "2014-09-09T21:00:00", "pickup": [40.682691, -73.975324]}, "macklemore @Madison Square Garden, 2013-12-13T20:00:00": {"date": "2013-12-13T20:00:00", "pickup": [40.7504807, -73.9933853]}, "jason%20mraz @Saturday Night Live, 2009-01-31T22:00:00": {"date": "2009-01-31T22:00:00", "pickup": [40.71455, -74.007124]}, "pharrell%20williams @Madison Square Garden, 2014-07-14T19:00:00": {"date": "2014-07-14T19:00:00", "pickup": [40.7504807, -73.9933853]}, "maroon%205 @Madison Square Garden, 2015-03-05T19:00:00": {"date": "2015-03-05T19:00:00", "pickup": [40.7504807, -73.9933853]}, "enrique%20iglesias @Today Show Concert Series, 2010-07-16T18:00:00": {"date": "2010-07-16T18:00:00", "pickup": [40.7141667, -74.0063889]}, "snoop%20dogg @Randalls Island, 2012-07-29T19:00:00": {"date": "2012-07-29T19:00:00", "pickup": [40.7141667, -74.0063889]}, "u2 @Sullivan Theater, 2009-03-03T15:30:00": {"date": "2009-03-03T15:30:00", "pickup": [40.72635, -73.997128]}, "paul%20mccartney @Barclays Center, 2013-06-10T20:00:00": {"date": "2013-06-10T20:00:00", "pickup": [40.682691, -73.975324]}, "kanye%20west @Madison Square Garden, 2012-12-12T19:30:00": {"date": "2012-12-12T19:30:00", "pickup": [40.7504807, -73.9933853]}, "lady%20gaga @Roseland Ballroom, 2014-03-28T20:00:00": {"date": "2014-03-28T20:00:00", "pickup": [40.762979, -73.983492]}, "kenny%20chesney @ROCKS OFF Concert Cruise Series, 2013-05-18T19:00:00": {"date": "2013-05-18T19:00:00", "pickup": [40.76289, -74.00175]}, "drake @Radio City Music Hall, 2010-09-29T20:00:00": {"date": "2010-09-29T20:00:00", "pickup": [40.7599077, -74.001935]}, "the%20black%20eyed%20peas @Madison Square Garden, 2010-02-24T19:30:00": {"date": "2010-02-24T19:30:00", "pickup": [40.7504807, -73.9933853]}, "linkin%20park @Madison Square Garden, 2011-02-04T19:00:00": {"date": "2011-02-04T19:00:00", "pickup": [40.7504807, -73.9933853]}, "the%20black%20eyed%20peas @Central Park, 2011-06-09T19:00:00": {"date": "2011-06-09T19:00:00", "pickup": [40.773615, -73.971106]}, "avicii @Roseland Ballroom, 2013-10-10T19:00:00": {"date": "2013-10-10T19:00:00", "pickup": [40.762979, -73.983492]}, "alicia%20keys @Madison Square Garden, 2013-04-11T19:30:00": {"date": "2013-04-11T19:30:00", "pickup": [40.7504807, -73.9933853]}, "lady%20gaga @Roseland Ballroom, 2014-04-07T20:00:00": {"date": "2014-04-07T20:00:00", "pickup": [40.762979, -73.983492]}, "drake @Randalls Island, 2015-06-06T12:00:00": {"date": "2015-06-06T12:00:00", "pickup": [40.7964113, -73.9212846]}, "justin%20timberlake @Madison Square Garden, 2014-02-20T19:00:00": {"date": "2014-02-20T19:00:00", "pickup": [40.7504807, -73.9933853]}, "pharrell%20williams @Pier 94, 2013-11-01T19:00:00": {"date": "2013-11-01T19:00:00", "pickup": [40.767626, -73.996318]}, "macklemore @Governors Island, 2011-09-03T12:00:00": {"date": "2011-09-03T12:00:00", "pickup": [40.688145, -74.01918]}, "enrique%20iglesias @Barclays Center, 2013-09-22T19:00:00": {"date": "2013-09-22T19:00:00", "pickup": [40.682691, -73.975324]}, "paul%20mccartney @Barclays Center, 2013-06-08T20:00:00": {"date": "2013-06-08T20:00:00", "pickup": [40.682691, -73.975324]}, "lady%20gaga @Central Park, 2011-05-27T19:00:00": {"date": "2011-05-27T19:00:00", "pickup": [40.773615, -73.971106]}, "wiz%20khalifa @The Williamsburg Waterfront, 2009-08-23T14:00:00": {"date": "2009-08-23T14:00:00", "pickup": [40.655071, -73.948883]}, "the%20lumineers @Terminal 5, 2013-07-29T20:00:00": {"date": "2013-07-29T20:00:00", "pickup": [40.769704, -73.992414]}, "one%20direction @New York City Movie Theater TBA, 2013-08-26T19:00:00": {"date": "2013-08-26T19:00:00", "pickup": [40.71455, -74.007124]}, "the%20lumineers @Central Park SummerStage, 2012-08-06T17:30:00": {"date": "2012-08-06T17:30:00", "pickup": [40.770519, -73.968452]}, "kelly%20clarkson @Brooklyn Academy of Music, 2009-09-17T19:00:00": {"date": "2009-09-17T19:00:00", "pickup": [40.686443, -73.977715]}, "pharrell%20williams @Kryoman w Steve Aoki @ Pier 94, NYC, 2013-11-02T19:00:00": {"date": "2013-11-02T19:00:00", "pickup": [40.767626, -73.996318]}, "macklemore @Bowery Ballroom, 2011-12-06T20:00:00": {"date": "2011-12-06T20:00:00", "pickup": [40.720398, -73.993731]}, "ariana%20grande @Madison Square Garden, 2013-12-13T20:00:00": {"date": "2013-12-13T20:00:00", "pickup": [40.7504807, -73.9933853]}, "calvin%20harris @Roseland Ballroom, 2010-10-30T20:30:00": {"date": "2010-10-30T20:30:00", "pickup": [40.762979, -73.983492]}, "kenny%20chesney @Bryant Park, 2009-08-14T19:00:00": {"date": "2009-08-14T19:00:00", "pickup": [40.753775, -73.983404]}, "justin%20bieber @Hard Rock Cafe, 2009-09-24T18:00:00": {"date": "2009-09-24T18:00:00", "pickup": [40.756979, -73.986494]}, "mariah%20carey @Rumsey Playfield, Central Park, 2013-05-24T07:00:00": {"date": "2013-05-24T07:00:00", "pickup": [40.755481, -73.720673]}, "tim%20mcgraw @Tuttle Creek State Park, 2009-06-27T16:00:00": {"date": "2009-06-27T16:00:00", "pickup": [39.2608378, -96.5776784]}, "lady%20gaga @Radio City Music Hall, 2015-06-22T20:00:00": {"date": "2015-06-22T20:00:00", "pickup": [40.7599077, -73.9802926]}, "miley%20cyrus @Appearance on \"The Late Show, 2010-06-17T23:00:00": {"date": "2010-06-17T23:00:00", "pickup": [40.763802, -73.982833]}, "mariah%20carey @Beacon Theatre, 2014-12-22T20:00:00": {"date": "2014-12-22T20:00:00", "pickup": [40.7803275, -73.9816297]}, "lady%20gaga @Roseland Ballroom, 2014-03-31T20:00:00": {"date": "2014-03-31T20:00:00", "pickup": [40.762979, -73.983492]}, "justin%20timberlake @Madison Square Garden, 2014-02-21T20:00:00": {"date": "2014-02-21T20:00:00", "pickup": [40.7504807, -73.9933853]}, "justin%20timberlake @Barclays Center, 2013-11-06T20:00:00": {"date": "2013-11-06T20:00:00", "pickup": [40.682691, -73.975324]}, "alicia%20keys @Barclays Center, 2013-04-05T20:00:00": {"date": "2013-04-05T20:00:00", "pickup": [40.682691, -73.975324]}, "iggy%20azalea @Rockefeller Center, 2014-08-08T08:00:00": {"date": "2014-08-08T08:00:00", "pickup": [40.7586654, -73.9784933]}, "miley%20cyrus @Brooklyn Academy of Music, 2009-09-17T19:00:00": {"date": "2009-09-17T19:00:00", "pickup": [40.686443, -73.977715]}, "jason%20mraz @Z100's Jingle Ball, 2012-12-07T19:00:00": {"date": "2012-12-07T19:00:00", "pickup": [40.7504807, -73.9933853]}, "iggy%20azalea @Madison Square Garden, 2014-12-12T19:00:00": {"date": "2014-12-12T19:00:00", "pickup": [40.7504807, -73.9933853]}, "iggy%20azalea @JBL Live at Pier 97, 2014-09-26T19:00:00": {"date": "2014-09-26T19:00:00", "pickup": [40.771733, -73.995206]}, "alicia%20keys @Avery Fisher Hall, 2012-10-15T21:00:00": {"date": "2012-10-15T21:00:00", "pickup": [40.7718, -73.983215]}, "nicki%20minaj @Madison Square Garden, 2010-08-12T19:00:00": {"date": "2010-08-12T19:00:00", "pickup": [40.7504807, -73.9933853]}, "justin%20bieber @Its On, 2009-09-02T10:00:00": {"date": "2009-09-02T10:00:00", "pickup": [40.767368, -73.991241]}, "kenny%20chesney @Hard Rock Cafe, 2009-09-15T19:00:00": {"date": "2009-09-15T19:00:00", "pickup": [40.756979, -73.986494]}, "adele @New York Hall of Science, 2009-06-18T20:00:00": {"date": "2009-06-18T20:00:00", "pickup": [40.7479008, -73.8518416]}, "iggy%20azalea @Highline Ballroom, 2012-10-30T20:00:00": {"date": "2012-10-30T20:00:00", "pickup": [40.743339, -74.00656]}, "coldplay @Radio City Music Hall, 2012-03-04T19:00:00": {"date": "2012-03-04T19:00:00", "pickup": [40.649903, -74.001935]}, "prince @Madison Square Garden, 2010-12-18T19:00:00": {"date": "2010-12-18T19:00:00", "pickup": [40.7504807, -73.9933853]}, "justin%20bieber @Barclays Center, 2013-08-02T19:00:00": {"date": "2013-08-02T19:00:00", "pickup": [40.682691, -73.975324]}, "selena%20gomez @LATE SHOW, 2010-07-20T23:30:00": {"date": "2010-07-20T23:30:00", "pickup": [40.763802, -73.982833]}, "calvin%20harris @The Fillmore New York at Irving Plaza, 2009-04-07T19:00:00": {"date": "2009-04-07T19:00:00", "pickup": [40.7349, -73.9884]}, "calvin%20harris @The Studio at Webster Hall, 2009-03-13T20:00:00": {"date": "2009-03-13T20:00:00", "pickup": [40.7316609, -73.9891926]}, "lady%20gaga @Terminal 5, 2009-05-02T19:00:00": {"date": "2009-05-02T19:00:00", "pickup": [40.769704, -73.992414]}, "pink @Madison Square Garden, 2009-10-05T20:00:00": {"date": "2009-10-05T20:00:00", "pickup": [40.7504807, -73.9933853]}, "enrique%20iglesias @Madison Square Garden, 2013-12-13T20:00:00": {"date": "2013-12-13T20:00:00", "pickup": [40.7504807, -73.9933853]}, "lady%20gaga @Madison Square Garden, 2011-02-21T20:00:00": {"date": "2011-02-21T20:00:00", "pickup": [40.7504807, -73.9933853]}, "lady%20gaga @MTV Video Music Awards, 2009-09-13T21:00:00": {"date": "2009-09-13T21:00:00", "pickup": [40.7141667, -74.0063889]}, "avicii @Pier 94, 2011-12-31T21:00:00": {"date": "2011-12-31T21:00:00", "pickup": [40.767626, -73.996318]}, "drake @Barclays Center, 2013-10-28T20:00:00": {"date": "2013-10-28T20:00:00", "pickup": [40.682691, -73.975324]}, "macklemore @The Theater at Madison Square Garden, 2013-11-13T19:30:00": {"date": "2013-11-13T19:30:00", "pickup": [40.7504807, -73.9933853]}, "miley%20cyrus @Nassau Coliseum, 2009-11-19T19:00:00": {"date": "2009-11-19T19:00:00", "pickup": [40.71455, -74.007118]}, "calvin%20harris @Pier 94, 2013-10-26T21:00:00": {"date": "2013-10-26T21:00:00", "pickup": [40.767626, -73.996318]}, "jason%20mraz @Brooklyn Center for the Performing Arts, 2014-09-17T19:00:00": {"date": "2014-09-17T19:00:00", "pickup": [40.631627, -73.948814]}, "ariana%20grande @Madison Square Garden, 2014-12-12T19:00:00": {"date": "2014-12-12T19:00:00", "pickup": [40.7504807, -73.9933853]}, "avicii @Barclays Center, 2014-06-28T20:00:00": {"date": "2014-06-28T20:00:00", "pickup": [40.682691, -73.975324]}, "avicii @Randall's Island, 2013-08-30T11:00:00": {"date": "2013-08-30T11:00:00", "pickup": [40.7141667, -74.0063889]}, "calvin%20harris @The Fillmore New York at Irving Plaza, 2009-04-08T19:00:00": {"date": "2009-04-08T19:00:00", "pickup": [40.7349, -73.9884]}, "justin%20bieber @PC Richard & Son Theatre, 2010-03-15T19:00:00": {"date": "2010-03-15T19:00:00", "pickup": [40.7141667, -74.0063889]}, "jason%20mraz @Battery Park, 2009-08-01T12:00:00": {"date": "2009-08-01T12:00:00", "pickup": [40.703457, -74.016787]}, "paul%20mccartney @Madison Square Garden, 2012-12-12T19:30:00": {"date": "2012-12-12T19:30:00", "pickup": [40.7504807, -73.9933853]}, "kanye%20west @Madison Square Garden, 2013-11-24T19:00:00": {"date": "2013-11-24T19:00:00", "pickup": [40.7504807, -73.9933853]}, "chris%20brown @Manhattan Center Hammerstein Ballroom, 2013-04-16T19:00:00": {"date": "2013-04-16T19:00:00", "pickup": [40.752535, -73.99391]}, "pitbull @Madison Square Garden, 2013-12-13T20:00:00": {"date": "2013-12-13T20:00:00", "pickup": [40.7504807, -73.9933853]}, "lady%20gaga @Radio City Music Hall, 2010-01-20T19:30:00": {"date": "2010-01-20T19:30:00", "pickup": [40.7599077, -74.001935]}, "pitbull @Manhattan Center Hammerstein Ballroom, 2014-09-28T12:00:00": {"date": "2014-09-28T12:00:00", "pickup": [40.752535, -73.99391]}, "snoop%20dogg @Water Taxi Beach Governors Island, 2010-08-28T19:00:00": {"date": "2010-08-28T19:00:00", "pickup": [40.7349, -73.9884]}, "drake @Governors Ball 2015, 2015-06-05T12:00:00": {"date": "2015-06-05T12:00:00", "pickup": [40.794065, -73.9271644]}, "pink @Madison Square Garden, 2013-03-22T20:00:00": {"date": "2013-03-22T20:00:00", "pickup": [40.7504807, -73.9933853]}, "pitbull @Madison Square Garden, 2014-10-30T19:30:00": {"date": "2014-10-30T19:30:00", "pickup": [40.7504807, -73.9933853]}, "prince @Madison Square Garden, 2011-01-18T19:30:00": {"date": "2011-01-18T19:30:00", "pickup": [40.7504807, -73.9933853]}, "miley%20cyrus @Madison Square Garden, 2013-12-13T20:00:00": {"date": "2013-12-13T20:00:00", "pickup": [40.7504807, -73.9933853]}, "iggy%20azalea @Irving Plaza, 2014-05-05T19:00:00": {"date": "2014-05-05T19:00:00", "pickup": [40.73482, -73.988313]}, "the%20lumineers @Mercury Lounge, 2011-08-30T19:00:00": {"date": "2011-08-30T19:00:00", "pickup": [40.72215, -73.986825]}, "enrique%20iglesias @Madison Square Garden, 2011-02-05T20:00:00": {"date": "2011-02-05T20:00:00", "pickup": [40.7504807, -73.9933853]}, "katy%20perry @Barclays Center, 2014-07-24T19:00:00": {"date": "2014-07-24T19:00:00", "pickup": [40.682691, -73.975324]}, "chris%20brown @Barclays Center, 2014-10-30T20:00:00": {"date": "2014-10-30T20:00:00", "pickup": [40.682691, -73.975324]}, "avicii @Radio City Music Hall, 2012-09-26T20:00:00": {"date": "2012-09-26T20:00:00", "pickup": [40.649903, -74.001935]}, "madonna @Madison Square Garden, 2012-11-13T20:00:00": {"date": "2012-11-13T20:00:00", "pickup": [40.7504807, -73.9933853]}, "paul%20mccartney @Apollo Theatre NY, 2010-12-13T19:00:00": {"date": "2010-12-13T19:00:00", "pickup": [40.810232, -73.949836]}, "paul%20mccartney @Iridium Jazz Club, 2010-10-20T20:30:00": {"date": "2010-10-20T20:30:00", "pickup": [40.761754, -73.983412]}, "selena%20gomez @Barclays Center, 2013-10-16T19:00:00": {"date": "2013-10-16T19:00:00", "pickup": [40.682691, -73.975324]}, "pink @Beacon Theatre, 2013-12-07T20:00:00": {"date": "2013-12-07T20:00:00", "pickup": [40.7803275, -73.9816297]}, "wiz%20khalifa @Playstation Theater, 2010-11-13T21:00:00": {"date": "2010-11-13T21:00:00", "pickup": [40.757419, -73.98603]}, "pink @Barclays Center, 2013-12-09T19:00:00": {"date": "2013-12-09T19:00:00", "pickup": [40.682691, -73.975324]}, "one%20direction @Beacon Theatre, 2012-05-26T20:00:00": {"date": "2012-05-26T20:00:00", "pickup": [40.7803275, -73.9816297]}, "the%20black%20eyed%20peas @Central Park, 2011-09-30T19:00:00": {"date": "2011-09-30T19:00:00", "pickup": [40.770519, -73.968452]}, "enrique%20iglesias @Madison Square Garden, 2014-09-25T19:00:00": {"date": "2014-09-25T19:00:00", "pickup": [40.7504807, -73.9933853]}, "one%20direction @Madison Square Garden, 2012-12-03T19:30:00": {"date": "2012-12-03T19:30:00", "pickup": [40.7504807, -73.9933853]}, "nicki%20minaj @Nassau Coliseum, 2011-03-27T19:00:00": {"date": "2011-03-27T19:00:00", "pickup": [40.71455, -74.007118]}, "drake @S.O.B.'s, 2009-05-26T21:00:00": {"date": "2009-05-26T21:00:00", "pickup": [40.7284588, -74.0052816]}, "justin%20bieber @Madison Square Garden, 2012-11-29T19:00:00": {"date": "2012-11-29T19:00:00", "pickup": [40.7504807, -73.9933853]}, "radiohead @Roseland Ballroom, 2011-09-29T18:30:00": {"date": "2011-09-29T18:30:00", "pickup": [40.762979, -73.983492]}, "madonna @Barclays Center, 2014-02-05T19:00:00": {"date": "2014-02-05T19:00:00", "pickup": [40.682691, -73.975324]}, "britney%20spears @Madison Square Garden, 2009-08-24T20:00:00": {"date": "2009-08-24T20:00:00", "pickup": [40.7504807, -73.9933853]}, "snoop%20dogg @Gramercy Theatre, 2011-03-29T20:30:00": {"date": "2011-03-29T20:30:00", "pickup": [40.7397537, -73.9850129]}, "wiz%20khalifa @Water Taxi Beach Governors Island, 2010-08-28T19:00:00": {"date": "2010-08-28T19:00:00", "pickup": [40.7141667, -74.0063889]}, "nicki%20minaj @Webster Hall, 2012-12-25T22:00:00": {"date": "2012-12-25T22:00:00", "pickup": [40.7316609, -73.9891926]}, "rihanna @Madison Square Garden, 2010-08-12T19:00:00": {"date": "2010-08-12T19:00:00", "pickup": [40.7504807, -73.9933853]}, "katy%20perry @The Fillmore New York at Irving Plaza, 2009-04-08T19:00:00": {"date": "2009-04-08T19:00:00", "pickup": [40.735, -73.9884]}, "justin%20bieber @Madison Square Garden, 2010-08-31T19:00:00": {"date": "2010-08-31T19:00:00", "pickup": [40.7504807, -73.9933853]}, "britney%20spears @Madison Square Garden, 2009-08-26T20:00:00": {"date": "2009-08-26T20:00:00", "pickup": [40.7504807, -73.9933853]}, "calvin%20harris @Electric Zoo @ Randall\u2019s Island Park, 2011-09-04T19:00:00": {"date": "2011-09-04T19:00:00", "pickup": [40.79545, -73.92268]}, "kelly%20clarkson @Radio City Music Hall, 2012-01-21T20:00:00": {"date": "2012-01-21T20:00:00", "pickup": [40.7599077, -74.001935]}, "avicii @Pacha NYC, 2011-04-23T19:00:00": {"date": "2011-04-23T19:00:00", "pickup": [40.763476, -73.997057]}, "nicki%20minaj @Pacha NYC, 2015-02-15T22:00:00": {"date": "2015-02-15T22:00:00", "pickup": [40.763476, -73.997057]}, "ariana%20grande @Madison Square Garden, 2015-03-20T19:00:00": {"date": "2015-03-20T19:00:00", "pickup": [40.7504807, -73.9933853]}, "selena%20gomez @Madison Square Garden, 2013-12-13T20:00:00": {"date": "2013-12-13T20:00:00", "pickup": [40.7504807, -73.9933853]}, "blake%20shelton @Madison Square Garden, 2014-08-01T19:00:00": {"date": "2014-08-01T19:00:00", "pickup": [40.7504807, -73.9933853]}, "nicki%20minaj @Stage 48, 2015-02-12T22:30:00": {"date": "2015-02-12T22:30:00", "pickup": [40.764801, -73.995987]}, "one%20direction @Rumsey Playfield, Central Park, 2013-11-26T07:00:00": {"date": "2013-11-26T07:00:00", "pickup": [40.755481, -73.720673]}, "lady%20gaga @Carnegie Hall, 2010-05-13T19:00:00": {"date": "2010-05-13T19:00:00", "pickup": [40.764875, -73.980498]}, "wiz%20khalifa @Webster Hall, 2014-11-17T21:00:00": {"date": "2014-11-17T21:00:00", "pickup": [40.7316609, -73.9891926]}, "calvin%20harris @Santos Party House, 2010-04-01T22:00:00": {"date": "2010-04-01T22:00:00", "pickup": [40.71756, -74.001315]}, "pitbull @Roseland Ballroom, 2011-12-29T20:00:00": {"date": "2011-12-29T20:00:00", "pickup": [40.762979, -73.983492]}, "lady%20gaga @Madison Square Garden, 2013-02-23T19:00:00": {"date": "2013-02-23T19:00:00", "pickup": [40.7504807, -73.9933853]}, "jason%20mraz @TODAY Show, 2014-07-18T06:00:00": {"date": "2014-07-18T06:00:00", "pickup": [40.71455, -74.007124]}, "jason%20mraz @Carnegie Hall, 2011-11-23T03:30:00": {"date": "2011-11-23T03:30:00", "pickup": [40.764875, -73.980498]}, "pitbull @Rumsey Playfield, Central Park, 2013-05-31T07:00:00": {"date": "2013-05-31T07:00:00", "pickup": [40.755481, -73.720673]}, "miley%20cyrus @Appearance on \"Good Morning America\", 2010-06-18T07:00:00": {"date": "2010-06-18T07:00:00", "pickup": [40.757024, -73.985824]}, "alicia%20keys @Beacon Theatre, 2011-06-30T20:30:00": {"date": "2011-06-30T20:30:00", "pickup": [40.7803275, -73.9816297]}, "pitbull @Madison Square Garden, 2009-12-11T19:30:00": {"date": "2009-12-11T19:30:00", "pickup": [40.7504807, -73.9933853]}, "justin%20timberlake @Barclays Center, 2014-12-14T20:00:00": {"date": "2014-12-14T20:00:00", "pickup": [40.682691, -73.975324]}, "kanye%20west @Barclays Center, 2013-11-20T19:30:00": {"date": "2013-11-20T19:30:00", "pickup": [40.682691, -73.975324]}, "pitbull @S.O.B.'s, 2009-04-22T21:00:00": {"date": "2009-04-22T21:00:00", "pickup": [40.7284588, -74.0052816]}, "fergie @Madison Square Garden, 2010-02-24T19:30:00": {"date": "2010-02-24T19:30:00", "pickup": [40.7504807, -73.9933853]}, "lady%20gaga @Radio City Music Hall, 2010-01-23T19:30:00": {"date": "2010-01-23T19:30:00", "pickup": [40.7599077, -74.001935]}, "katy%20perry @Madison Square Garden, 2011-11-16T19:30:00": {"date": "2011-11-16T19:30:00", "pickup": [40.7504807, -73.9933853]}, "mariah%20carey @Beacon Theatre, 2014-12-16T20:00:00": {"date": "2014-12-16T20:00:00", "pickup": [40.7803275, -73.9816297]}, "justin%20timberlake @Madison Square Garden, 2014-02-19T19:00:00": {"date": "2014-02-19T19:00:00", "pickup": [40.7504807, -73.9933853]}, "iggy%20azalea @S.O.B.'s, 2012-05-17T20:00:00": {"date": "2012-05-17T20:00:00", "pickup": [40.7284588, -74.0052816]}, "snoop%20dogg @Terminal 5, 2011-12-05T19:00:00": {"date": "2011-12-05T19:00:00", "pickup": [40.769704, -73.992414]}, "paul%20mccartney @Citi Field, 2009-07-17T19:00:00": {"date": "2009-07-17T19:00:00", "pickup": [40.7571, -73.8458]}, "lady%20gaga @Radio City Music Hall, 2015-06-20T20:00:00": {"date": "2015-06-20T20:00:00", "pickup": [40.7599077, -73.9802926]}, "pitbull @Nokia Theatre Times Square, 2010-06-24T20:00:00": {"date": "2010-06-24T20:00:00", "pickup": [40.757423, -73.986023]}, "lady%20gaga @Radio City Music Hall, 2015-06-23T19:00:00": {"date": "2015-06-23T19:00:00", "pickup": [40.7599077, -73.9802926]}, "calvin%20harris @Madison Square Garden, 2014-12-12T19:00:00": {"date": "2014-12-12T19:00:00", "pickup": [40.7504807, -73.9933853]}, "enrique%20iglesias @Madison Square Garden, 2010-12-10T19:00:00": {"date": "2010-12-10T19:00:00", "pickup": [40.7504807, -73.9933853]}, "adele @Roseland Ballroom, 2009-05-05T20:00:00": {"date": "2009-05-05T20:00:00", "pickup": [40.762979, -73.983492]}, "rihanna @Barclays Center, 2013-05-07T20:00:00": {"date": "2013-05-07T20:00:00", "pickup": [40.682691, -73.975324]}, "alicia%20keys @Madison Square Garden, 2012-12-12T19:30:00": {"date": "2012-12-12T19:30:00", "pickup": [40.7504807, -73.9933853]}, "pitbull @Barclays Center, 2013-12-26T20:00:00": {"date": "2013-12-26T20:00:00", "pickup": [40.682691, -73.975324]}, "justin%20bieber @Performance, 2009-11-27T09:00:00": {"date": "2009-11-27T09:00:00", "pickup": [40.7141667, -74.0063889]}, "maroon%205 @Madison Square Garden, 2015-03-06T19:00:00": {"date": "2015-03-06T19:00:00", "pickup": [40.7504807, -73.9933853]}, "lady%20gaga @Roseland Ballroom, 2014-04-02T20:00:00": {"date": "2014-04-02T20:00:00", "pickup": [40.762979, -73.983492]}, "blake%20shelton @Tuttle Creek State Park, 2009-06-27T16:00:00": {"date": "2009-06-27T16:00:00", "pickup": [39.2608378, -96.5776784]}, "alicia%20keys @Nokia Theatre Times Square, 2009-12-01T20:00:00": {"date": "2009-12-01T20:00:00", "pickup": [40.757423, -73.986023]}, "enrique%20iglesias @Madison Square Garden, 2014-02-15T20:00:00": {"date": "2014-02-15T20:00:00", "pickup": [40.7504807, -73.9933853]}, "blake%20shelton @Turtle Creek State Park, 2011-06-25T19:30:00": {"date": "2011-06-25T19:30:00", "pickup": [39.2608378, -96.5776784]}, "wiz%20khalifa @Webster Hall, 2014-11-16T21:00:00": {"date": "2014-11-16T21:00:00", "pickup": [40.7316609, -73.9891926]}, "jason%20mraz @Roseland Ballroom, 2013-09-15T12:00:00": {"date": "2013-09-15T12:00:00", "pickup": [40.762979, -73.983492]}, "paul%20mccartney @Rockwood Music Hall, 2009-04-04T19:00:00": {"date": "2009-04-04T19:00:00", "pickup": [40.7218927, -73.988847]}, "wiz%20khalifa @The Studio at Webster Hall, 2009-07-14T20:00:00": {"date": "2009-07-14T20:00:00", "pickup": [40.7316609, -73.9891926]}, "mariah%20carey @Beacon Theatre, 2014-12-18T20:00:00": {"date": "2014-12-18T20:00:00", "pickup": [40.7803275, -73.9816297]}, "macklemore @The Theater at Madison Square Garden, 2013-11-15T19:30:00": {"date": "2013-11-15T19:30:00", "pickup": [40.7504807, -73.9933853]}, "linkin%20park @Barclays Center, 2015-01-25T19:00:00": {"date": "2015-01-25T19:00:00", "pickup": [40.682691, -73.975324]}, "maroon%205 @Madison Square Garden, 2013-02-16T20:00:00": {"date": "2013-02-16T20:00:00", "pickup": [40.7504807, -73.9933853]}, "justin%20timberlake @Manhattan Center Hammerstein Ballroom, 2014-07-10T20:00:00": {"date": "2014-07-10T20:00:00", "pickup": [40.752535, -73.99391]}, "wiz%20khalifa @Terminal 5, 2011-12-05T19:00:00": {"date": "2011-12-05T19:00:00", "pickup": [40.769704, -73.992414]}, "drake @Nikon at Jones Beach Theater, 2012-06-16T19:00:00": {"date": "2012-06-16T19:00:00", "pickup": [40.623974, -73.970713]}, "macklemore @Irving Plaza powered by Klipsch, 2012-11-20T19:00:00": {"date": "2012-11-20T19:00:00", "pickup": [40.73482, -73.988313]}, "avicii @Radio City Music Hall, 2012-09-27T22:00:00": {"date": "2012-09-27T22:00:00", "pickup": [40.649903, -74.001935]}, "rihanna @Hammerstein Ballroom, 2009-12-03T20:00:00": {"date": "2009-12-03T20:00:00", "pickup": [40.752535, -73.99391]}, "the%20lumineers @Barclays Center, 2012-12-21T19:00:00": {"date": "2012-12-21T19:00:00", "pickup": [40.682691, -73.975324]}, "pink @Barclays Center, 2013-12-08T19:30:00": {"date": "2013-12-08T19:30:00", "pickup": [40.682691, -73.975324]}, "selena%20gomez @Playstation Theater, 2013-01-19T20:00:00": {"date": "2013-01-19T20:00:00", "pickup": [40.757419, -73.98603]}, "the%20lumineers @Terminal 5, 2013-02-01T19:00:00": {"date": "2013-02-01T19:00:00", "pickup": [40.769704, -73.992414]}, "snoop%20dogg @The Wellmont Theatre, 2011-03-26T20:00:00": {"date": "2011-03-26T20:00:00", "pickup": [40.812646, -74.2167]}, "kanye%20west @Madison Square Garden, 2013-11-23T20:00:00": {"date": "2013-11-23T20:00:00", "pickup": [40.7504807, -73.9933853]}, "chris%20brown @Barclays Center, 2013-09-22T19:00:00": {"date": "2013-09-22T19:00:00", "pickup": [40.682691, -73.975324]}, "ariana%20grande @Irving Plaza powered by Klipsch, 2011-12-28T18:00:00": {"date": "2011-12-28T18:00:00", "pickup": [40.73482, -73.988313]}, "enrique%20iglesias @Madison Square Garden, 2014-10-30T19:30:00": {"date": "2014-10-30T19:30:00", "pickup": [40.7504807, -73.9933853]}, "macklemore @Webster Hall, 2011-04-16T19:00:00": {"date": "2011-04-16T19:00:00", "pickup": [40.7316609, -73.9891926]}, "mariah%20carey @Madison Square Garden, 2009-12-31T21:00:00": {"date": "2009-12-31T21:00:00", "pickup": [40.7504807, -73.9933853]}, "maroon%205 @Z100 Jingle Ball, 2014-12-12T19:00:00": {"date": "2014-12-12T19:00:00", "pickup": [40.714489, -74.007133]}, "katy%20perry @NBC, 2010-08-27T19:00:00": {"date": "2010-08-27T19:00:00", "pickup": [40.75851, -73.979004]}, "iggy%20azalea @Highline Ballroom, 2012-12-17T20:00:00": {"date": "2012-12-17T20:00:00", "pickup": [40.743339, -74.00656]}, "jason%20mraz @Radio City Music Hall, 2014-09-23T19:00:00": {"date": "2014-09-23T19:00:00", "pickup": [40.7599077, -73.9802926]}, "pharrell%20williams @Madison Square Garden, 2014-07-15T19:30:00": {"date": "2014-07-15T19:30:00", "pickup": [40.7504807, -73.9933853]}, "katy%20perry @The Fillmore New York at Irving Plaza, 2009-04-06T19:00:00": {"date": "2009-04-06T19:00:00", "pickup": [40.735, -73.9884]}, "prince @Madison Square Garden, 2010-12-29T19:00:00": {"date": "2010-12-29T19:00:00", "pickup": [40.7504807, -73.9933853]}, "selena%20gomez @Gramercy Theatre, 2010-02-11T19:00:00": {"date": "2010-02-11T19:00:00", "pickup": [40.7397537, -73.9850129]}, "lil%20wayne @Nassau Coliseum, 2011-03-28T19:00:00": {"date": "2011-03-28T19:00:00", "pickup": [40.71455, -74.007118]}, "lil%20wayne @Nassau Coliseum, 2011-03-27T19:00:00": {"date": "2011-03-27T19:00:00", "pickup": [40.71455, -74.007118]}, "tim%20mcgraw @CMAC, 2012-06-29T19:00:00": {"date": "2012-06-29T19:00:00", "pickup": [40.71455, -74.007118]}, "rihanna @Barclays Center, 2013-05-05T19:00:00": {"date": "2013-05-05T19:00:00", "pickup": [40.682691, -73.975324]}, "jason%20mraz @Radio City Music Hall, 2014-09-22T19:00:00": {"date": "2014-09-22T19:00:00", "pickup": [40.7599077, -73.9802926]}, "coldplay @Beacon Theatre, 2014-05-05T21:00:00": {"date": "2014-05-05T21:00:00", "pickup": [40.7803275, -73.9816297]}, "kelly%20clarkson @The View, 2009-07-30T20:00:00": {"date": "2009-07-30T20:00:00", "pickup": [40.776027, -73.987638]}, "macklemore @The Theater at Madison Square Garden, 2013-11-14T19:30:00": {"date": "2013-11-14T19:30:00", "pickup": [40.7504807, -73.9933853]}, "iggy%20azalea @Bowery Ballroom, 2013-06-16T20:00:00": {"date": "2013-06-16T20:00:00", "pickup": [40.720398, -73.993731]}, "calvin%20harris @Pacha NYC, 2011-05-06T22:00:00": {"date": "2011-05-06T22:00:00", "pickup": [40.763476, -73.997057]}, "lady%20gaga @Madison Square Garden, 2011-02-22T20:00:00": {"date": "2011-02-22T20:00:00", "pickup": [40.7504807, -73.9933853]}, "madonna @Madison Square Garden, 2012-11-12T20:00:00": {"date": "2012-11-12T20:00:00", "pickup": [40.7504807, -73.9933853]}, "nicki%20minaj @Manhattan Center Grand Ballroom, 2010-11-25T19:30:00": {"date": "2010-11-25T19:30:00", "pickup": [40.752535, -73.99391]}, "pitbull @Radio City Music Hall, 2012-04-07T20:00:00": {"date": "2012-04-07T20:00:00", "pickup": [40.649903, -74.001935]}, "mariah%20carey @Beacon Theatre, 2014-12-21T20:00:00": {"date": "2014-12-21T20:00:00", "pickup": [40.7803275, -73.9816297]}, "paul%20mccartney @Citi Field, 2009-07-21T18:30:00": {"date": "2009-07-21T18:30:00", "pickup": [40.7571, -73.8458]}, "avicii @The Beach at Governors Island, 2011-07-17T16:00:00": {"date": "2011-07-17T16:00:00", "pickup": [40.6894501, -74.016792]}, "miley%20cyrus @Barclays Center, 2014-04-05T19:00:00": {"date": "2014-04-05T19:00:00", "pickup": [40.682691, -73.975324]}, "kelly%20clarkson @Hammerstein Ballroom, 2009-10-06T20:00:00": {"date": "2009-10-06T20:00:00", "pickup": [40.752535, -73.99391]}, "iggy%20azalea @Playstation Theater, 2012-09-20T19:00:00": {"date": "2012-09-20T19:00:00", "pickup": [40.757419, -73.98603]}, "justin%20bieber @Barclays Center, 2012-11-12T19:00:00": {"date": "2012-11-12T19:00:00", "pickup": [40.682691, -73.975324]}, "lady%20gaga @Barclays Center, 2013-03-07T20:00:00": {"date": "2013-03-07T20:00:00", "pickup": [40.682691, -73.975324]}, "kanye%20west @Barclays Center, 2013-11-19T20:00:00": {"date": "2013-11-19T20:00:00", "pickup": [40.682691, -73.975324]}, "justin%20bieber @Nintendo World Store, 2009-09-01T15:00:00": {"date": "2009-09-01T15:00:00", "pickup": [40.758911, -73.979019]}, "pitbull @Madison Square Garden, 2014-09-25T19:00:00": {"date": "2014-09-25T19:00:00", "pickup": [40.7504807, -73.9933853]}, "chris%20brown @Roseland Ballroom, 2013-10-29T20:00:00": {"date": "2013-10-29T20:00:00", "pickup": [40.762979, -73.983492]}, "katy%20perry @Barclays Center, 2014-07-25T19:00:00": {"date": "2014-07-25T19:00:00", "pickup": [40.682691, -73.975324]}, "david%20banner @S.O.B.'s, 2012-05-23T21:00:00": {"date": "2012-05-23T21:00:00", "pickup": [40.7284588, -74.0052816]}, "lady%20gaga @Madison Square Garden, 2010-07-06T20:00:00": {"date": "2010-07-06T20:00:00", "pickup": [40.7504807, -73.9933853]}, "jason%20mraz @Carnegie Hall, 2011-11-25T03:30:00": {"date": "2011-11-25T03:30:00", "pickup": [40.764875, -73.980498]}, "alicia%20keys @Great Lawn at Central Park, 2013-09-28T16:00:00": {"date": "2013-09-28T16:00:00", "pickup": [40.781354, -73.966487]}, "lady%20gaga @Roseland Ballroom, 2014-04-04T20:00:00": {"date": "2014-04-04T20:00:00", "pickup": [40.762979, -73.983492]}, "drake @Randalls Island, 2015-06-07T12:00:00": {"date": "2015-06-07T12:00:00", "pickup": [40.8619003, -73.8268967]}, "drake @Radio City Music Hall, 2010-09-28T20:00:00": {"date": "2010-09-28T20:00:00", "pickup": [40.7599077, -74.001935]}, "kenny%20chesney @ROCKS OFF Concert Cruise Series, 2015-05-02T19:00:00": {"date": "2015-05-02T19:00:00", "pickup": [40.76289, -74.00175]}, "lady%20gaga @Radio City Music Hall, 2010-01-21T19:30:00": {"date": "2010-01-21T19:30:00", "pickup": [40.7599077, -74.001935]}, "u2 @Madison Square Garden, 2009-10-30T19:30:00": {"date": "2009-10-30T19:30:00", "pickup": [40.7504807, -73.9933853]}, "justin%20bieber @Madison Square Garden, 2012-11-28T19:00:00": {"date": "2012-11-28T19:00:00", "pickup": [40.7504807, -73.9933853]}, "snoop%20dogg @Snoop Dogg & Puff Daddy Hot 97 Tip-Off at Madison Square Garden, 2015-02-12T20:00:00": {"date": "2015-02-12T20:00:00", "pickup": [40.7504807, -73.9933853]}, "lady%20gaga @Radio City Music Hall, 2010-01-24T19:30:00": {"date": "2010-01-24T19:30:00", "pickup": [40.649903, -74.001935]}, "mariah%20carey @Beacon Theatre, 2014-12-20T20:00:00": {"date": "2014-12-20T20:00:00", "pickup": [40.7803275, -73.9816297]}, "macklemore @Manhattan Center Hammerstein Ballroom, 2014-05-21T21:00:00": {"date": "2014-05-21T21:00:00", "pickup": [40.752535, -73.99391]}, "toby%20keith @Bethel Woods Center, 2014-07-27T19:00:00": {"date": "2014-07-27T19:00:00", "pickup": [41.6966322, -74.8773957]}}

def load_events(string_dict):
    '''
    Get information from the concert events.
    Takes:
        -string_dict, a string with the address of the json of events

    Returns:
        -events, a dictionary with event information preprocessed 
    '''
    d = string_dict
    events = {}

    for key, value in d.items():
        date = value['date']
        events[key] = {}
        events[key]['date'] = datetime.strptime(date, '%Y-%m-%dT%H:%M:%S')
        events[key]['pickup'] = value['pickup']

    return events

EVENTS = load_events(EVENTS_JSON)

def get_trip_info(line):
    '''
    Get information from the yellow taxi rides. Manually comment/uncomment time and date 
    when processing ubers or taxis.
    Takes:
        -line, a line of a csv file 

    Returns:
        -(date, pickup), a tuple with a datetime object referring to the
        moment of pickup and a tuple of coordinates, indicating latitude
        and logitude of pickup
    '''
    try:
        f = line.split(',')
        # time = f[TAXI_DATE_COL]	
        time = f[UBER_DATE_COL]
        time = time.strip('"')
        # date = datetime.strptime(time, '%Y-%m-%d %H:%M:%S') # for taxis 
        date = datetime.strptime(time, '%m/%d/%Y %H:%M:%S') # for ubers 
    except:
        return None, None

    # lat = float(f[TAXI_PICKUP_LAT_COL])
    # lon = float(f[TAXI_PICKUP_LON_COL])
    lat = float(f[UBER_LAT_COL])
    lon = float(f[UBER_LON_COL])
    pickup = (lat, lon)
    
    return date, pickup

def check_event(date, pickup, events = EVENTS):
    '''
    For every ride in a taxi ride file, checks if it took place in any
    of the concerts of the previous dictionary.

    Takes:
        -date, a datetime object with the date and hour of the trip
        -pickup, a pair of (lat, lon) coordinates 

    Returns:
        -key, the info of a concert if found on the concert dictionary
        -None if the trip doesn't match any concert
    '''
    for key, value in events.items():
        if haversine(value['pickup'], pickup) < KM_DIST:
            min_hour = value['date']   
            max_hour = value['date'] + timedelta(hours = HOURS_OF_TOLERANCE)
            if date >= min_hour and date <= max_hour :
                return key
    return None

class MRGetTripsDuringEvent(MRJob):

    def steps(self):
        return [
            MRStep(mapper=self.mapper_get_event_trips,
                    combiner=self.combiner_event_trips,
                    reducer=self.reducer_event_trips)
        ]

    def mapper_get_event_trips(self, _, line):
        '''
        For each line in the csv, yield a pair indicating the
        event name and a count of one (1)
        '''
        date, pickup = get_trip_info(line)
        if date != None:
            event = check_event(date, pickup)
            if event != None:
                yield (event, 1)

    def combiner_event_trips(self, event, counts):
        '''
        Combine to events, summing the counts
        '''
        yield (event, sum(counts))

    def reducer_event_trips(self, event, counts):
        '''
        Reduce to events, summing the counts
        '''
        yield (event, sum(counts))

if __name__ == '__main__':
    MRGetTripsDuringEvent.run()
